<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Hiking Permit Form</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    form { max-width: 400px; }
    label { display: block; margin-top: 1em; }
    input, select { width: 100%; }
    .error { color: red; margin-bottom: 1em; }
    .success { color: green; margin-bottom: 1em; }
  </style>
</head>
<body>

<h1>Hiking Permit Application</h1>
<div id="message"></div>

<form id="permitForm">
  <label>Name:
    <input type="text" id="name" required />
  </label>
  <label>Email:
    <input type="email" id="email" required />
  </label>
  <label>Permit Date:
    <input type="date" id="permitDate" required />
  </label>
  <label>Permit Type:
    <select id="permitType">
      <option value="Hiking">Hiking</option>
      <option value="Biking">Biking</option>
    </select>
  </label>
  <label>
    <input type="checkbox" id="waiver" required />
    I have read and agree to the attached waiver.
  </label>
  <button type="submit">Submit</button>
</form>

<script>
  const form = document.getElementById('permitForm');
  const message = document.getElementById('message');

  // Your published Apps Script Web App URL:
  const APPS_SCRIPT_URL = "PASTE_YOUR_WEB_APP_URL_HERE";

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    message.textContent = "";

    const name = document.getElementById('name').value.trim();
    const email = document.getElementById('email').value.trim();
    const permitDate = document.getElementById('permitDate').value;
    const permitType = document.getElementById('permitType').value;
    const waiverConfirmed = document.getElementById('waiver').checked;

    const payload = {
      name,
      email,
      permitDate,
      permitType,
      waiverConfirmed
    };

    try {
      const response = await fetch(APPS_SCRIPT_URL, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        // If you get CORS errors, try removing this or set to 'no-cors' 
        // but then you can't read the response data.
        body: JSON.stringify(payload)
      });
      const result = await response.json(); // parse JSON from doPost

      if (!result.success) {
        // Show the error message from the server
        message.classList.remove('success');
        message.classList.add('error');
        message.textContent = result.error || "Unknown error.";
        return;
      }

      // If success, we have permitNumber, name, email, etc.
      const permitNumber = result.permitNumber;
      // Redirect to confirmation.html with query params or localStorage
      // Example using query parameters:
      const queryParams = new URLSearchParams({
        permitNumber: permitNumber,
        name,
        email,
        permitDate,
        permitType
      }).toString();

      window.location.href = "confirmation.html?" + queryParams;

    } catch (err) {
      message.classList.remove('success');
      message.classList.add('error');
      message.textContent = "Submission failed: " + err;
    }
  });
</script>

</body>
</html>
